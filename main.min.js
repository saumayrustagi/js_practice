"use strict";const canvas=document.getElementById("myCanvas"),ctx=canvas.getContext("2d"),imageUrl="./assets/profile_flower.png",image=new Image;let dragOffsetX,dragOffsetY,isImageLoaded=!1,imageCropData={sx:0,sy:0,sWidth:0,sHeight:0},square={x:40,y:40,width:120,height:120},isDragging=!1;function drawSquare(){ctx.clearRect(0,0,canvas.width,canvas.height),isImageLoaded?ctx.drawImage(image,imageCropData.sx,imageCropData.sy,imageCropData.sWidth,imageCropData.sHeight,square.x,square.y,square.width,square.height):(ctx.fillStyle="lightgray",ctx.fillRect(square.x,square.y,square.width,square.height),ctx.fillStyle="black",ctx.font="12px Arial",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText("Loading...",square.x+square.width/2,square.y+square.height/2))}function handleMouseDown(e){e.offsetX>square.x&&e.offsetX<square.x+square.width&&e.offsetY>square.y&&e.offsetY<square.y+square.height&&(isDragging=!0,dragOffsetX=e.offsetX-square.x,dragOffsetY=e.offsetY-square.y)}function handleMouseMove(e){isDragging&&(square.x=e.offsetX-dragOffsetX,square.y=e.offsetY-dragOffsetY,square.x+square.width>canvas.width&&(square.x=canvas.width-square.width),square.y+square.height>canvas.height&&(square.y=canvas.height-square.height),square.x<0&&(square.x=0),square.y<0&&(square.y=0),drawSquare())}function handleMouseUp(){isDragging=!1}image.onload=()=>{isImageLoaded=!0;const e=Math.min(image.width,image.height),a=e*(1-Math.SQRT1_2);imageCropData.sx=a/2,imageCropData.sy=a/2,imageCropData.sWidth=e-a,imageCropData.sHeight=e-a,drawSquare()},image.onerror=()=>{console.error("Failed to load image at URL:",imageUrl),drawSquare()},image.src=imageUrl,canvas.addEventListener("mousedown",handleMouseDown),canvas.addEventListener("mousemove",handleMouseMove),canvas.addEventListener("mouseup",handleMouseUp),drawSquare();